<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::body})}">
<head>
    <meta charset="UTF-8">
    <title>ìˆ˜ë¦¬ ìš”ì²­ ìˆ˜ì •</title>
</head>
<body>
<div class="max-w-2xl mx-auto px-4">
    <div class="bg-white dark:bg-gray-800 rounded-4 shadow p-4 mt-5">
        <div class="border-bottom border-success-subtle pb-2 mb-3">
            <h4 class="mb-0 fw-bold text-dark">ğŸ”§ ìˆ˜ë¦¬ ìš”ì²­ ìˆ˜ì •</h4>
        </div>

        <form th:action="@{|/repairs/${repairRequest.id}/edit|}" method="post" th:object="${repairRequest}">
            <input type="hidden" th:field="*{id}" />

            <div class="mb-3">
                <label for="type" class="form-label">ë¬¸ì œ ìœ í˜•</label>
                <select id="type" th:field="*{category}" class="form-select" onchange="updateDynamicFields()" required>
                    <option value="">-- ì„ íƒí•˜ì„¸ìš” --</option>
                    <option value="HW">í•˜ë“œì›¨ì–´ ë¬¸ì œ</option>
                    <option value="SW">ì†Œí”„íŠ¸ì›¨ì–´ ë¬¸ì œ</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="problemDetail" class="form-label">ì„¸ë¶€ ë¬¸ì œ</label>
                <select id="problemDetail" name="detailType" class="form-select" required>
                    <option value="">-- ë¬¸ì œ ìœ í˜• ë¨¼ì € ì„ íƒ --</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="description" class="form-label">ìƒì„¸ ì‚¬ìœ </label>
                <textarea id="description" th:field="*{description}" class="form-control" rows="4"
                          placeholder="ë¬¸ì œì˜ êµ¬ì²´ì ì¸ ìƒí™©ì„ ì‘ì„±í•´ì£¼ì„¸ìš”" required></textarea>
            </div>

            <div class="mb-3">
                <label for="assignee" class="form-label">ë‹´ë‹¹ì</label>
                <select id="assignee" name="manager" class="form-select" required>
                    <option value="">-- ë¬¸ì œ ìœ í˜• ë¨¼ì € ì„ íƒ --</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="cmosPassword" class="form-label">CMOS ë¹„ë°€ë²ˆí˜¸</label>
                <input type="text" id="cmosPassword" th:field="*{cmosPassword}" class="form-control" required />
            </div>

            <div class="mb-3">
                <label for="windowsPassword" class="form-label">Windows ë¹„ë°€ë²ˆí˜¸</label>
                <input type="text" id="windowsPassword" th:field="*{windowsPassword}" class="form-control" required />
            </div>

            <div class="d-grid">
                <button type="submit" class="btn-green">ìˆ˜ì • ì™„ë£Œ</button>
            </div>
        </form>
    </div>
</div>

<script th:inline="javascript">
    const hwAssignees = ["ê¹€í•˜ëŠ˜", "ë°•ì² ìˆ˜", "ì´ê°•ë¯¼"];
    const swAssignees = ["ìµœì§€ì›", "ì •ìœ ì§„", "í™ì„œì¤€"];

    const hwDetails = ["í™”ë©´ ì´ìƒ", "ë¶€íŒ… ë¶ˆê°€", "ì†Œë¦¬ ë¬¸ì œ"];
    const swDetails = ["í”„ë¡œê·¸ë¨ ì˜¤ë¥˜", "ë¡œê·¸ì¸ ë¶ˆê°€", "ì—…ë°ì´íŠ¸ ì‹¤íŒ¨"];

    function updateDynamicFields(selectedDetail, selectedAssignee) {
        const type = document.getElementById("type").value;
        const detailSelect = document.getElementById("problemDetail");
        const assigneeSelect = document.getElementById("assignee");

        detailSelect.innerHTML = '<option value="">-- ë¬¸ì œë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>';
        assigneeSelect.innerHTML = '<option value="">-- ë‹´ë‹¹ìë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>';

        let details = [];
        let assignees = [];

        if (type === "HW") {
            details = hwDetails;
            assignees = hwAssignees;
        } else if (type === "SW") {
            details = swDetails;
            assignees = swAssignees;
        }

        details.forEach(d => {
            const option = document.createElement("option");
            option.value = d;
            option.text = d;
            if (d === selectedDetail) option.selected = true;
            detailSelect.appendChild(option);
        });

        assignees.forEach(a => {
            const option = document.createElement("option");
            option.value = a;
            option.text = a;
            if (a === selectedAssignee) option.selected = true;
            assigneeSelect.appendChild(option);
        });
    }

    document.addEventListener("DOMContentLoaded", function () {
        const selectedDetail = /*[[${repairRequest.detailType}]]*/ '';
        const selectedAssignee = /*[[${repairRequest.manager}]]*/ '';
        setTimeout(() => {
            updateDynamicFields(selectedDetail, selectedAssignee);
        }, 50);
    });
</script>
</body>
</html>