<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::body})}">
<head>
    <title>수리 요청 내역</title>
    <meta charset="UTF-8" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">

    <h2 class="mb-4">🛠 수리 요청 결과 및 내역</h2>

    <!-- 최근 수리 요청 요약 -->
    <div th:if="${recentRepair != null}" class="card mb-4">
        <div class="card-header bg-primary text-white">
            최근 제출한 수리 요청
        </div>
        <div class="card-body">
            <ul class="list-group list-group-flush">
                <li class="list-group-item"><strong>요청일시:</strong> <span th:text="${#temporals.format(recentRepair.createdAt, 'yyyy-MM-dd HH:mm')}"></span></li>
                <li class="list-group-item"><strong>문제유형:</strong> <span th:text="${recentRepair.category}"></span></li>
                <li class="list-group-item"><strong>세부문제:</strong> <span th:text="${recentRepair.detailType}"></span></li>
                <li class="list-group-item"><strong>담당자:</strong> <span th:text="${recentRepair.manager}"></span></li>
                <li class="list-group-item"><strong>진행상태:</strong> <span th:text="${recentRepair.status}"></span></li>
            </ul>
        </div>
    </div>

    <!-- 처리중 요청 알림 -->
    <div th:if="${openRepairsCount > 0}" class="alert alert-warning">
        현재 처리 중인 요청이 <strong th:text="${openRepairsCount}"></strong>건 있습니다.
    </div>

    <!-- 전체 수리 요청 내역 -->
    <div class="mb-3 d-flex justify-content-between align-items-center">
        <h4 class="mb-0">나의 수리 요청 히스토리</h4>
        <a href="/repairs/new" class="btn btn-success btn-sm">+ 새 수리 요청</a>
    </div>

    <table class="table table-striped table-bordered text-center align-middle">
        <thead class="table-light">
        <tr>
            <th>요청일</th>
            <th>문제유형</th>
            <th>세부문제</th>
            <th>담당자</th>
            <th>상태</th>
            <th>관리</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="repair : ${repairs}">
            <td th:text="${#temporals.format(repair.createdAt, 'yyyy-MM-dd')}">요청일</td>
            <td th:text="${repair.category}">문제유형</td>
            <td th:text="${repair.detailType}">세부문제</td>
            <td th:text="${repair.manager}">담당자</td>
            <td th:text="${repair.status}">상태</td>
            <td>
                <a th:href="@{/repairs/{id}/edit(id=${repair.id})}" class="btn btn-sm btn-outline-primary me-1">✏ 수정</a>
                <form th:action="@{/repairs/delete/{id}(id=${repair.id})}" method="post" style="display:inline;">
                    <button class="btn btn-sm btn-outline-danger" type="submit" onclick="return confirm('정말 삭제하시겠습니까?')">🗑 삭제</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>

</div>
</body>
</html>