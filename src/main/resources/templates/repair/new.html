<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::body})}">
<head>
    <title>수리 요청</title>
    <meta charset="UTF-8" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">🛠 수리 요청서 작성</h4>
        </div>
        <div class="card-body">
            <form th:action="@{/repairs}" method="post">

                <div class="mb-3">
                    <label for="type" class="form-label">문제 유형</label>
                    <select id="type" name="category" class="form-select" onchange="updateDynamicFields()" required>
                        <option value="">-- 선택하세요 --</option>
                        <option value="HW">하드웨어 문제</option>
                        <option value="SW">소프트웨어 문제</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="problemDetail" class="form-label">세부 문제</label>
                    <select id="problemDetail" name="detailType" class="form-select" required>
                        <option value="">-- 문제 유형 먼저 선택 --</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="details" class="form-label">상세 사유</label>
                    <textarea id="details" name="details" class="form-control" rows="4" placeholder="문제의 구체적인 상황을 작성해주세요" required></textarea>
                </div>

                <div class="mb-3">
                    <label for="assignee" class="form-label">담당자</label>
                    <select id="assignee" name="manager" class="form-select" required>
                        <option value="">-- 문제 유형 먼저 선택 --</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label for="cmosPw" class="form-label">CMOS 비밀번호</label>
                    <input type="text" id="cmosPw" name="cmosPw" class="form-control" required />
                </div>

                <div class="mb-3">
                    <label for="windowsPw" class="form-label">Windows 비밀번호</label>
                    <input type="text" id="windowsPw" name="windowsPw" class="form-control" required />
                </div>

                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-success">📨 요청 제출</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- 👇 스크립트는 바디 맨 아래에 위치시켜야 DOM 요소 인식 가능 -->
<script>
    const hwAssignees = ["김하늘", "박철수", "이강민"];
    const swAssignees = ["최지원", "정유진", "홍서준"];

    const hwDetails = ["화면 이상", "부팅 불가", "소리 문제"];
    const swDetails = ["프로그램 오류", "로그인 불가", "업데이트 실패"];

    function updateDynamicFields() {
        const type = document.getElementById("type").value;
        const detailSelect = document.getElementById("problemDetail");
        const assigneeSelect = document.getElementById("assignee");

        detailSelect.innerHTML = '<option value="">-- 문제를 선택하세요 --</option>';
        assigneeSelect.innerHTML = '<option value="">-- 담당자를 선택하세요 --</option>';

        let details = [];
        let assignees = [];

        if (type === "HW") {
            details = hwDetails;
            assignees = hwAssignees;
        } else if (type === "SW") {
            details = swDetails;
            assignees = swAssignees;
        }

        details.forEach(d => {
            const option = document.createElement("option");
            option.value = d;
            option.text = d;
            detailSelect.appendChild(option);
        });

        assignees.forEach(a => {
            const option = document.createElement("option");
            option.value = a;
            option.text = a;
            assigneeSelect.appendChild(option);
        });
    }
</script>
</body>
</html>