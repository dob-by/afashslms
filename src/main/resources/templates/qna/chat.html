<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  lang="ko"
  th:replace="layout :: layout(~{::content})"
>
  <head>
    <title>Q&A 챗봇</title>
  </head>
  <body>
    <!-- 🔹 스타일 fragment -->
    <div th:fragment="styles">
      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
      />
      <style>
        :root {
          --brand: #43a047;
          --bubble-radius: 18px;
        }
        .chat-wrapper {
          height: calc(100vh - 160px);
          display: flex;
          flex-direction: column;
        }
        #chatMessages {
          flex: 1;
          overflow-y: auto;
          padding: 1rem;
          background: #fff;
        }
        .user-bubble {
          background: var(--brand);
          color: #fff;
          padding: 10px 14px;
          border-radius: var(--bubble-radius);
          border-top-right-radius: 4px;
          max-width: 70%;
          word-break: break-word;
        }
        .ai-bubble {
          background: #f1f3f5;
          color: #212529;
          padding: 10px 14px;
          border-radius: var(--bubble-radius);
          border-top-left-radius: 4px;
          max-width: 70%;
          word-break: break-word;
        }
        .btn-send {
          border-radius: 50%;
          width: 44px;
          height: 44px;
          display: flex;
          align-items: center;
          justify-content: center;
          background: var(--brand);
          color: #fff;
          border: none;
        }
      </style>
    </div>

    <!-- 🔹 본문 fragment -->
    <div th:fragment="content">
      <div class="chat-wrapper">
        <div class="row g-4 h-100">
          <!-- 좌측 -->
          <div class="col-lg-3 col-md-4 h-100">
            <div class="card h-100 shadow-sm">
              <div
                class="card-header d-flex justify-content-between align-items-center"
              >
                <strong>대화 기록</strong>
                <button class="btn btn-sm btn-success" id="newChatBtn">
                  <i class="bi bi-plus-lg"></i>
                </button>
              </div>
              <div
                class="list-group list-group-flush overflow-auto flex-grow-1"
                id="historyList"
              >
                <button class="list-group-item list-group-item-action">
                  오늘의 질문
                </button>
              </div>
            </div>
          </div>

          <!-- 우측 -->
          <div class="col-lg-9 col-md-8 h-100">
            <div class="card h-100 shadow-sm">
              <div
                class="card-header d-flex align-items-center gap-2 bg-success text-white"
              >
                <i class="bi bi-robot fs-5"></i>
                <div><div class="fw-semibold">WingITs 도우미</div></div>
              </div>
              <div class="card-body d-flex flex-column">
                <div id="chatMessages" class="flex-grow-1 overflow-auto mb-3">
                  <div class="d-flex justify-content-start mb-2">
                    <div class="ai-bubble">
                      안녕하세요! 무엇을 도와드릴까요?
                    </div>
                  </div>
                </div>
                <form id="chatForm" class="d-flex gap-2 border-top pt-2">
                  <input
                    type="text"
                    id="userInput"
                    class="form-control"
                    placeholder="질문을 입력하세요..."
                    autocomplete="off"
                  />
                  <button type="submit" class="btn-send" id="sendBtn">
                    <i class="bi bi-arrow-up-short fs-4"></i>
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 페이지 스크립트 로드는 컨트롤러의 pageScript로 처리됨 -->
    <!-- 개별 페이지 스크립트 -->
    <th:block th:if="${pageScript}">
      <script th:src="@{${pageScript}}"></script>
    </th:block>
  </body>
</html>
